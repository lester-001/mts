<?xml version="1.0" encoding="UTF-8"?>
<!-- Related XMLSchema file: conf/schemas/scenario.xsd -->
<scenario>
    <function name="handleContextSetup">
        <input>
        </input>
    
        <do>    
            <call name="initContext" > </call>  
                
            <call name="RegComp" >
                <input>
                </input>
                <output>
                    <parameter name="[function:reg_msgd]" />
                </output>
            </call>
            
            <call name="encryptNasMessage" >
                <input>
                    <parameter name="[function:plainNasMessage]" value="[reg_msgd]"/>
                </input>
                <output>
                    <parameter name="[function:out_encrypt_ret]" />
                    <parameter name="[function:out_encrypt_msg]" />
                    <parameter name="[function:out_sqn]" />
                    <parameter name="[function:out_overflow]" />
                </output>
            </call>

            <parameter name="[uplinkCount_sqn]" operation="set" value="[out_sqn]"/>  
            <parameter name="[uplinkCount_overflow]" operation="set" value="[out_overflow]"/>  
            <parameter name="[send_nas_pdu_msg]" operation="set" value="[out_encrypt_msg]"/>  

            <call name="uplinkNas" >
                <input>
                    <parameter name="[function:nas_pdu_msg]"  value="[send_nas_pdu_msg]"/>
                </input>
            </call>    

            <call name="PduEstablishRequest" >
                <input>
                </input>
                <output>
                    <parameter name="[function:est_request_enc]" />
                </output>
            </call>

            <call name="encryptNasMessage" >
                <input>
                    <parameter name="[function:plainNasMessage]" value="[est_request_enc]"/>
                </input>
                <output>
                    <parameter name="[function:out_encrypt_ret]" />
                    <parameter name="[function:out_encrypt_msg]" />
                    <parameter name="[function:out_sqn]" />
                    <parameter name="[function:out_overflow]" />
                </output>
            </call>
            
            <parameter name="[send_nas_pdu_msg]" operation="set" value="[out_encrypt_msg]"/>  
            <call name="uplinkNas" >
                <input>
                    <parameter name="[function:nas_pdu_msg]"  value="[send_nas_pdu_msg]"/>
                </input>
            </call> 

            <parameter name="[out_ret]" operation="set" value="true"/>  
            <parameter name="[out_sqn]" operation="set" value="[out_sqn]"/>  
            <parameter name="[out_overflow]" operation="set" value="[out_overflow]"/>  
        </do>
      
        <output>
            <parameter name="[function:out_ret]" />
            <parameter name="[function:out_sqn]" />
            <parameter name="[function:out_overflow]" />
        </output>
    </function>
</scenario>
